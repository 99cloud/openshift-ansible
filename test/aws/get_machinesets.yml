---
- name: List existing worker nodes
  oc_obj:
    kubeconfig: "{{ kubeconfig_path }}"
    state: list
    kind: node
    selector: "node-role.kubernetes.io/worker"
  delegate_to: localhost
  register: pre_scaleup_workers
  until:
  - pre_scaleup_workers.results is defined
  - pre_scaleup_workers.results.returncode is defined
  - pre_scaleup_workers.results.results is defined
  - pre_scaleup_workers.results.returncode == 0
  - pre_scaleup_workers.results.results[0]['items'] | length > 0
  retries: 36
  delay: 5

- set_fact:
    pre_scaleup_workers_name: "{{ pre_scaleup_workers.results.results[0]['items'] |map(attribute='metadata.name') | list }}"

- name: get existing worker machinesets
  oc_obj:
    state: list
    kind: machinesets.machine.openshift.io
    namespace: openshift-machine-api
    selector: ""
    kubeconfig: "{{ kubeconfig_path }}"
  register: machineset
  until:
  - machineset.results is defined
  - machineset.results.returncode is defined
  - machineset.results.results is defined
  - machineset.results.returncode == 0
  - machineset.results.results[0]['items'] | length > 0
  retries: 36
  delay: 5

- set_fact:
    pre_scaleup_machineset_names: "{{ machineset.results.results[0]['items'] |map(attribute='metadata.name') | list }}"
